#!/usr/bin/env python3
"""
더미 데이터 SQL 생성 스크립트
사용자 50명, 게시글 350개 생성
"""

import random
from datetime import datetime, timedelta

# BCrypt 해시 (password123)
BCRYPT_HASH = "$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy"

# 사용자 이름 리스트
USER_NAMES = [
    '김민수', '이지은', '박준호', '최수진', '정태영', '한소영', '윤성민', '강미라', '조현우', '임다혜',
    '송재현', '오지혜', '신동욱', '류하늘', '배수진', '전민석', '홍예린', '고영수', '문채원', '양준혁',
    '구민지', '남도현', '도서연', '라현우', '마지훈', '백서윤', '서동욱', '안지혜', '유승민', '은하늘',
    '인지훈', '장민서', '전유진', '정하늘', '차민준', '최서연', '태민수', '하준영', '허지원', '현수빈',
    '황민지', '강동원', '김태리', '이병헌', '박보영', '최우식', '정유미', '한지민', '김수현', '이민호'
]

# 카테고리별 게시글 템플릿
POST_TEMPLATES = {
    '개발': [
        ('Spring Boot로 REST API 개발하기', 'Spring Boot를 사용해서 REST API를 개발하는 방법을 공유합니다. 먼저 프로젝트를 생성하고 의존성을 추가해야 합니다. build.gradle에 spring-boot-starter-web을 추가하시면 됩니다. 그 다음 Controller를 만들어서 @RestController 어노테이션을 사용하면 간단하게 REST API를 만들 수 있어요.', 'Spring Boot,Java,REST API,JPA'),
        ('React Hooks 완벽 가이드', 'React Hooks를 사용하면서 느낀 점들을 공유합니다. useState는 상태 관리를, useEffect는 사이드 이펙트를 처리하는데 정말 유용합니다. 특히 커스텀 훅을 만들어서 재사용 가능한 로직을 분리하면 코드가 훨씬 깔끔해집니다.', 'React,JavaScript,Hooks,Frontend'),
        ('Python으로 웹 크롤링 배우기', 'Python의 BeautifulSoup과 requests 라이브러리를 사용해서 웹 크롤링을 해보았습니다. 먼저 requests.get()으로 웹페이지를 가져오고, BeautifulSoup으로 HTML을 파싱합니다. 데이터를 수집한 후에는 pandas로 정리하거나 CSV 파일로 저장할 수 있습니다.', 'Python,크롤링,BeautifulSoup,데이터수집'),
        ('Docker로 개발 환경 구축하기', 'Docker를 사용해서 개발 환경을 구축하는 방법을 정리했습니다. Dockerfile을 작성해서 이미지를 만들고, docker-compose.yml로 여러 서비스를 한번에 관리할 수 있어요. 데이터베이스, 백엔드, 프론트엔드를 각각 컨테이너로 만들어서 실행하면 로컬 환경과 프로덕션 환경의 차이를 줄일 수 있습니다.', 'Docker,DevOps,컨테이너,인프라'),
        ('TypeScript로 타입 안전한 코드 작성하기', 'TypeScript를 사용하면서 느낀 장점들을 공유합니다. 타입을 명시해서 컴파일 타임에 에러를 잡을 수 있어서 개발 효율이 정말 좋아졌어요. 인터페이스와 타입 별칭을 사용해서 코드의 가독성도 높아지고, 리팩토링할 때도 안전합니다.', 'TypeScript,JavaScript,타입시스템,Frontend'),
        ('MySQL 쿼리 최적화 팁', 'MySQL 쿼리 성능을 개선하는 방법들을 정리했습니다. 인덱스를 적절히 사용하면 쿼리 속도가 크게 향상됩니다. EXPLAIN으로 실행 계획을 확인해서 인덱스가 제대로 사용되는지 확인하세요. JOIN을 사용할 때는 작은 테이블을 먼저 조인하고, WHERE 조건을 먼저 필터링하는 것이 좋습니다.', 'MySQL,데이터베이스,쿼리최적화,SQL'),
        ('Git 브랜치 전략과 협업 워크플로우', 'Git Flow와 GitHub Flow 같은 브랜치 전략을 실제 프로젝트에 적용한 경험을 공유합니다. main 브랜치는 항상 배포 가능한 상태로 유지하고, feature 브랜치에서 새 기능을 개발합니다. Pull Request를 통해 코드 리뷰를 받고, CI/CD 파이프라인으로 자동 테스트를 실행합니다.', 'Git,버전관리,협업,DevOps'),
        ('Node.js로 실시간 채팅 서버 만들기', 'Socket.io를 사용해서 실시간 채팅 서버를 만드는 방법을 정리했습니다. WebSocket을 사용하면 서버와 클라이언트가 양방향 통신을 할 수 있어요. 방(room) 개념을 사용해서 여러 채팅방을 만들 수 있고, 사용자 인증도 추가할 수 있습니다.', 'Node.js,Socket.io,WebSocket,실시간통신'),
        ('Vue.js 3 Composition API 사용기', 'Vue.js 3의 Composition API를 사용해서 프로젝트를 진행한 경험을 공유합니다. setup() 함수 안에서 reactive, ref를 사용해서 반응형 데이터를 만들 수 있어요. computed와 watch로 파생 상태와 사이드 이펙트를 처리할 수 있고, 라이프사이클 훅도 사용할 수 있습니다.', 'Vue.js,JavaScript,Composition API,Frontend'),
        ('AWS EC2에 웹 애플리케이션 배포하기', 'AWS EC2 인스턴스를 생성하고 웹 애플리케이션을 배포하는 과정을 정리했습니다. 먼저 EC2 인스턴스를 생성하고, 보안 그룹에서 필요한 포트를 열어줍니다. SSH로 접속해서 서버 환경을 설정하고, Nginx를 설치해서 리버스 프록시로 사용합니다.', 'AWS,EC2,배포,인프라,DevOps'),
    ],
    '자격증': [
        ('정보처리기사 실기 합격 후기', '안녕하세요! 정보처리기사 실기 시험에 합격해서 후기를 남깁니다. 먼저 시험 구성은 알고리즘 3문제, SQL 2문제, 업무프로세스 1문제로 구성되어 있습니다. 알고리즘은 기출문제를 많이 풀어보는 것이 중요해요. 특히 정렬, 탐색, 재귀 관련 문제가 자주 나옵니다.', '정보처리기사,IT자격증,합격후기'),
        ('SQLD 자격증 공부 방법', 'SQLD(SQL 개발자) 자격증을 준비하면서 정리한 내용을 공유합니다. 시험은 주관식과 단답형으로 구성되어 있고, 데이터 모델링과 SQL 기본/활용이 주요 내용입니다. 데이터 모델링에서는 정규화, 엔티티, 관계 등을 이해해야 하고, SQL에서는 SELECT, JOIN, 서브쿼리 등을 잘 알아야 해요.', 'SQLD,데이터베이스,자격증'),
        ('컴활 1급 실기 합격 노하우', '컴퓨터활용능력 1급 실기 시험에 합격한 후기를 남깁니다. 시험은 엑셀과 액세스 두 과목으로 구성되어 있고, 각각 40분씩 주어집니다. 엑셀에서는 함수, 피벗테이블, 차트 등을 다룰 수 있어야 하고, 액세스에서는 쿼리와 폼, 보고서를 만들 수 있어야 해요.', '컴활1급,엑셀,액세스,자격증'),
        ('토익 900점 달성 후기', '토익 시험에서 900점을 받았습니다! 공부 방법을 공유합니다. 먼저 LC는 매일 1시간씩 듣기 연습을 했어요. 특히 파트 3, 4는 문제를 먼저 읽고 듣는 것이 중요합니다. RC는 문법과 어휘를 꾸준히 공부하고, 시간 안에 풀 수 있도록 연습했습니다.', '토익,영어,어학자격증'),
        ('리눅스마스터 2급 합격 후기', '리눅스마스터 2급 시험에 합격했습니다! 공부 방법을 공유합니다. 시험은 필기와 실기로 나뉘어져 있고, 필기는 객관식, 실기는 서술형과 실무형입니다. 필기에서는 리눅스 기본 명령어, 파일 시스템, 네트워크 설정 등을 알아야 해요.', '리눅스마스터,리눅스,자격증'),
    ],
    '영어': [
        ('영어 회화 스터디 모집합니다', '안녕하세요! 영어 회화 실력을 향상시키고 싶은 분들과 함께 스터디를 하고 싶습니다. 매주 화요일 저녁 7시에 온라인으로 만나서 영어로 대화를 나누는 시간을 가질 예정입니다. 주제는 매주 정해서 프레젠테이션을 하고, 자유롭게 토론하는 형식으로 진행하려고 해요.', '영어회화,스터디,온라인'),
        ('토익 스피킹 시험 준비 스터디', '토익 스피킹 시험을 준비하는 분들과 함께 공부하고 싶습니다. 매주 목요일 저녁에 만나서 모의고사를 풀고, 서로 피드백을 주고받는 시간을 가질 예정입니다. 각 파트별로 연습하고, 발음과 억양도 함께 개선해나가요.', '토익스피킹,영어,스터디'),
        ('영어 원서 읽기 모임', '영어 원서를 함께 읽고 토론하는 모임을 만들고 싶습니다. 매주 일요일 오후에 만나서 한 챕터씩 읽고, 내용을 영어로 토론하는 시간을 가질 예정입니다. 초반에는 쉬운 책부터 시작해서 점차 난이도를 높여나가요.', '영어원서,독서,토론'),
        ('오픽 시험 준비 스터디', '오픽 시험을 준비하는 분들과 함께 공부하고 싶습니다. 매주 수요일 저녁에 만나서 모의고사를 풀고, 서로 피드백을 주고받는 시간을 가질 예정입니다. 각 유형별로 연습하고, 자연스러운 표현을 익히는 것이 목표입니다.', '오픽,영어,스터디'),
        ('영어 작문 스터디 모집', '영어 작문 실력을 향상시키고 싶은 분들과 함께 스터디를 하고 싶습니다. 매주 금요일 저녁에 만나서 주제를 정해서 에세이를 쓰고, 서로 첨삭하는 시간을 가질 예정입니다. 문법과 표현을 함께 공부하고, 다양한 주제로 연습해나가요.', '영어작문,에세이,스터디'),
    ],
    '독서': [
        ('월 1권 독서 모임 모집', '안녕하세요! 매월 한 권씩 책을 읽고 토론하는 모임을 만들고 싶습니다. 매주 토요일 오후에 만나서 읽은 책에 대해 이야기 나누는 시간을 가질 예정입니다. 소설, 에세이, 자기계발서 등 다양한 장르를 읽어요.', '독서,토론,모임'),
        ('경영/경제 도서 스터디', '경영과 경제 관련 도서를 함께 읽고 토론하는 스터디를 만들고 싶습니다. 매주 일요일 오전에 만나서 한 챕터씩 읽고, 내용을 정리하고 토론하는 시간을 가질 예정입니다. 실제 사례와 연결해서 생각해보고, 서로의 의견을 나누면서 깊이 있게 공부해요.', '경영,경제,독서,스터디'),
        ('철학서 함께 읽기 모임', '철학서를 함께 읽고 토론하는 모임을 만들고 싶습니다. 매주 수요일 저녁에 만나서 한 챕터씩 읽고, 내용을 정리하고 토론하는 시간을 가질 예정입니다. 서양 철학과 동양 철학을 번갈아가며 읽어요.', '철학,독서,토론'),
        ('역사서 읽기 스터디', '역사서를 함께 읽고 토론하는 스터디를 만들고 싶습니다. 매주 목요일 저녁에 만나서 한 챕터씩 읽고, 내용을 정리하고 토론하는 시간을 가질 예정입니다. 한국사와 세계사를 번갈아가며 읽어요.', '역사,독서,스터디'),
        ('과학 도서 읽기 모임', '과학 도서를 함께 읽고 토론하는 모임을 만들고 싶습니다. 매주 금요일 저녁에 만나서 한 챕터씩 읽고, 내용을 정리하고 토론하는 시간을 가질 예정입니다. 물리, 화학, 생물 등 다양한 분야를 읽어요.', '과학,독서,토론'),
    ],
    '취업': [
        ('IT 기업 면접 준비 스터디', 'IT 기업 면접을 준비하는 분들과 함께 스터디를 하고 싶습니다. 매주 월요일 저녁에 만나서 면접 질문을 연습하고, 서로 피드백을 주고받는 시간을 가질 예정입니다. 기술 면접과 인성 면접을 모두 준비해요.', '면접,IT,취업준비'),
        ('포트폴리오 작성 스터디', '포트폴리오를 작성하는 분들과 함께 스터디를 하고 싶습니다. 매주 화요일 저녁에 만나서 포트폴리오를 공유하고, 서로 피드백을 주고받는 시간을 가질 예정입니다. 디자인과 내용을 모두 개선해나가요.', '포트폴리오,취업준비'),
        ('자소서 작성 스터디', '자기소개서를 작성하는 분들과 함께 스터디를 하고 싶습니다. 매주 수요일 저녁에 만나서 자소서를 공유하고, 서로 피드백을 주고받는 시간을 가질 예정입니다. 각 기업별로 맞춤 자소서를 작성하는 방법을 함께 공부해요.', '자소서,취업준비'),
        ('코딩 테스트 준비 스터디', '코딩 테스트를 준비하는 분들과 함께 스터디를 하고 싶습니다. 매주 목요일 저녁에 만나서 알고리즘 문제를 풀고, 서로의 풀이를 공유하는 시간을 가질 예정입니다. 백준, 프로그래머스 문제를 함께 풀어요.', '코딩테스트,알고리즘,취업준비'),
        ('공기업 취업 준비 스터디', '공기업 취업을 준비하는 분들과 함께 스터디를 하고 싶습니다. 매주 금요일 저녁에 만나서 시험 문제를 풀고, 서로 피드백을 주고받는 시간을 가질 예정입니다. 인적성 검사와 전공 시험을 모두 준비해요.', '공기업,취업준비'),
    ],
    '기타': [
        ('요가 스터디 모집', '요가를 함께 배우고 실천하는 스터디를 만들고 싶습니다. 매주 일요일 오전에 만나서 요가를 함께 하는 시간을 가질 예정입니다. 초보자도 환영합니다! 서로 도와가며 실력을 키워나가요.', '요가,운동,건강'),
        ('요리 스터디 모집', '요리를 함께 배우고 실천하는 스터디를 만들고 싶습니다. 매주 토요일 오후에 만나서 요리를 함께 하는 시간을 가질 예정입니다. 다양한 요리를 만들어보고, 레시피를 공유해요.', '요리,취미'),
        ('사진 촬영 스터디', '사진 촬영을 함께 배우고 실천하는 스터디를 만들고 싶습니다. 매주 일요일 오후에 만나서 사진을 함께 찍는 시간을 가질 예정입니다. 다양한 장소를 방문해서 사진을 찍고, 서로의 작품을 공유해요.', '사진,취미'),
        ('음악 감상 모임', '음악을 함께 감상하고 토론하는 모임을 만들고 싶습니다. 매주 금요일 저녁에 만나서 음악을 함께 듣고, 감상을 나누는 시간을 가질 예정입니다. 다양한 장르의 음악을 들어보고, 서로의 생각을 공유해요.', '음악,취미'),
        ('영화 감상 모임', '영화를 함께 감상하고 토론하는 모임을 만들고 싶습니다. 매주 토요일 저녁에 만나서 영화를 함께 보고, 감상을 나누는 시간을 가질 예정입니다. 다양한 장르의 영화를 보고, 서로의 생각을 공유해요.', '영화,취미'),
    ]
}

# 카테고리별 게시글 수
POST_COUNTS = {
    '개발': 100,
    '자격증': 70,
    '영어': 70,
    '독서': 50,
    '취업': 40,
    '기타': 20
}

def generate_users():
    """사용자 50명 생성"""
    sql = "-- ============================================================\n"
    sql += "-- 1. 사용자 계정 50개 생성\n"
    sql += "-- ============================================================\n\n"
    sql += "SET FOREIGN_KEY_CHECKS = 0;\n\n"
    sql += "INSERT INTO `users` (`real_name`, `birth_date`, `email`, `password`, `email_verified`, `role`, `created_at`, `updated_at`) VALUES\n"
    
    users = []
    # 한글 이름을 영문 이메일로 변환하는 매핑
    name_to_email = {
        '김민수': 'kim.minsu', '이지은': 'lee.jieun', '박준호': 'park.junho', '최수진': 'choi.sujin', '정태영': 'jung.taeyoung',
        '한소영': 'han.soyoung', '윤성민': 'yoon.sungmin', '강미라': 'kang.mira', '조현우': 'cho.hyunwoo', '임다혜': 'lim.dahye',
        '송재현': 'song.jaehyun', '오지혜': 'oh.jihye', '신동욱': 'shin.dongwook', '류하늘': 'ryu.haneul', '배수진': 'bae.sujin',
        '전민석': 'jeon.minseok', '홍예린': 'hong.yerin', '고영수': 'go.youngsu', '문채원': 'moon.chaewon', '양준혁': 'yang.junhyuk',
        '구민지': 'gu.minji', '남도현': 'nam.dohyun', '도서연': 'do.seoyeon', '라현우': 'ra.hyunwoo', '마지훈': 'ma.jihun',
        '백서윤': 'baek.seoyoon', '서동욱': 'seo.dongwook', '안지혜': 'an.jihye', '유승민': 'yu.seungmin', '은하늘': 'eun.haneul',
        '인지훈': 'in.jihun', '장민서': 'jang.minseo', '전유진': 'jeon.yujin', '정하늘': 'jung.haneul', '차민준': 'cha.minjun',
        '최서연': 'choi.seoyeon', '태민수': 'tae.minsu', '하준영': 'ha.junyoung', '허지원': 'heo.jiwon', '현수빈': 'hyun.subin',
        '황민지': 'hwang.minji', '강동원': 'kang.dongwon', '김태리': 'kim.taeri', '이병헌': 'lee.byunghun', '박보영': 'park.boyoung',
        '최우식': 'choi.woosik', '정유미': 'jung.yumi', '한지민': 'han.jimin', '김수현': 'kim.soohyun', '이민호': 'lee.minho'
    }
    
    for i, name in enumerate(USER_NAMES):
        year = random.randint(1994, 1999)
        month = random.randint(1, 12)
        day = random.randint(1, 28)
        email = name_to_email.get(name, f'user{i+1}') + '@example.com'
        days_ago = random.randint(1, 180)
        
        users.append(f"('{name}', '{year}-{month:02d}-{day:02d}', '{email}', '{BCRYPT_HASH}', 1, 0, NOW() - INTERVAL {days_ago} DAY, NOW() - INTERVAL {days_ago} DAY)")
    
    sql += ',\n'.join(users) + ';\n\n'
    sql += "SET FOREIGN_KEY_CHECKS = 1;\n\n"
    return sql

def generate_posts():
    """게시글 350개 생성"""
    sql = "-- ============================================================\n"
    sql += "-- 2. 게시글 350개 생성\n"
    sql += "-- ============================================================\n\n"
    
    post_id = 1
    all_posts = []
    
    for category, count in POST_COUNTS.items():
        templates = POST_TEMPLATES.get(category, [])
        
        for i in range(count):
            if i < len(templates):
                title, content, tags = templates[i]
            else:
                # 템플릿이 부족하면 변형해서 생성
                base_idx = i % len(templates)
                base_title, base_content, base_tags = templates[base_idx]
                title = f"{base_title} ({i+1})"
                content = f"{base_content}\n\n이번에는 {i+1}번째로 작성하는 게시글입니다. 실제 프로젝트에서 경험한 내용을 바탕으로 상세하게 정리했습니다. 궁금한 점이 있으면 댓글로 남겨주세요!"
                tags = base_tags
            
            user_id = random.randint(1, 50)
            view_count = random.randint(10, 500)
            like_count = random.randint(1, 50)
            days_ago = random.randint(1, 180)
            
            # SQL 이스케이프
            title = title.replace("'", "\\'")
            content = content.replace("'", "\\'").replace('\n', '\\n')
            tags = tags.replace("'", "\\'")
            
            all_posts.append(f"({user_id}, '{title}', '{content}', '{category}', '{tags}', {view_count}, {like_count}, NOW() - INTERVAL {days_ago} DAY, NOW() - INTERVAL {days_ago} DAY)")
            post_id += 1
    
    sql += "INSERT INTO `posts` (`user_id`, `title`, `content`, `category`, `tags`, `view_count`, `like_count`, `created_at`, `updated_at`) VALUES\n"
    sql += ',\n'.join(all_posts) + ';\n\n'
    
    return sql

def generate_footer():
    """완료 메시지"""
    sql = "-- ============================================================\n"
    sql += "-- 완료 메시지\n"
    sql += "-- ============================================================\n"
    sql += "SELECT '더미 데이터 생성 완료!' AS message;\n"
    sql += "SELECT COUNT(*) AS total_users FROM users;\n"
    sql += "SELECT COUNT(*) AS total_posts FROM posts;\n"
    sql += "SELECT category, COUNT(*) AS count FROM posts GROUP BY category;\n"
    return sql

def main():
    """메인 함수"""
    sql = "-- ============================================================\n"
    sql += "-- Study With Me 더미 데이터 생성 스크립트\n"
    sql += "-- 사용자 50명, 게시글 350개 (각 카테고리별 분배)\n"
    sql += "-- ============================================================\n\n"
    
    sql += generate_users()
    sql += generate_posts()
    sql += generate_footer()
    
    with open('dummy_data.sql', 'w', encoding='utf-8') as f:
        f.write(sql)
    
    print("dummy_data.sql 파일이 생성되었습니다!")
    print(f"- 사용자: 50명")
    print(f"- 게시글: 350개")
    for category, count in POST_COUNTS.items():
        print(f"  - {category}: {count}개")

if __name__ == '__main__':
    main()
