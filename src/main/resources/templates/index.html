<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>모집 게시판 | Study With Me</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/css/board.css" />
    <link rel="stylesheet" href="/css/chatbot.css" />
</head>
<body class="light">

<header class="swm-header">
    <div class="nav-inner">
        <div class="logo" onclick="location.href='/'">Study With Me</div>
        <nav class="nav-links">
            <a href="/">모집 게시판</a>
            <a href="/recommend">AI 추천</a>
            <a th:if="${loginUser != null}" href="/study-groups">진행중인 스터디</a>
        </nav>
        <div class="nav-actions">
            <div th:if="${loginUser == null}">
                <a href="/auth" class="btn btn-outline">로그인</a>
                <a href="/register" class="btn btn-primary">회원가입</a>
            </div>
            <div th:if="${loginUser != null}" class="user-menu">
                <div class="notif-wrapper">
                    <button id="notifIcon" class="btn btn-icon" type="button" title="알림">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span id="notifBadge" class="notif-badge hidden"></span>
                    </button>
                    <div id="notifDropdown" class="notif-dropdown hidden"></div>
                </div>
                <a href="/bookmarks" class="btn btn-outline">북마크</a>
                <a href="/mypage" class="btn btn-outline">마이페이지</a>
                <a th:if="${loginUser.isAdmin()}" href="/admin" class="btn btn-admin">관리자</a>
                <a href="/posts/write" class="btn btn-primary">글쓰기</a>
                <a href="/logout" class="btn btn-outline">로그아웃</a>
            </div>
            <button id="darkModeBtn" class="btn btn-icon" title="다크모드">
                <svg id="darkModeIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
    </div>
</header>

<main class="page">

    <!-- 자격증 정보 슬라이드쇼 -->
    <section class="certification-slider" th:if="${certifications != null and !certifications.isEmpty()}">
        <div class="slider-header">
            <h2>다가오는 자격증 시험일정</h2>
            <p>공부할 때 필요한 자격증 정보를 확인하세요</p>
        </div>
        <div class="slider-container">
            <div class="slider-track" id="certSliderTrack">
                <div class="cert-card" th:each="cert : ${certifications}">
                    <div class="cert-badge" th:text="${cert.category ?: '자격증'}"></div>
                    <h3 th:text="${cert.name}">자격증 이름</h3>
                    <div class="cert-info">
                        <div class="cert-date">
                            <span class="cert-label">시험일</span>
                            <span th:text="${#temporals.format(cert.examDate, 'yyyy-MM-dd')}">2025-01-01</span>
                        </div>
                        <div class="cert-registration" th:if="${cert.registrationStart != null}">
                            <span class="cert-label">접수기간</span>
                            <span th:text="${#temporals.format(cert.registrationStart, 'MM-dd')} + ' ~ ' + ${#temporals.format(cert.registrationEnd, 'MM-dd')}">01-01 ~ 01-15</span>
                        </div>
                    </div>
                    <p class="cert-desc" th:text="${cert.description ?: ''}">자격증 설명</p>
                    <a th:if="${cert.website != null}" th:href="${cert.website}" target="_blank" class="cert-link">자세히 보기 →</a>
                </div>
            </div>
            <button class="slider-btn prev" id="certSliderPrev">‹</button>
            <button class="slider-btn next" id="certSliderNext">›</button>
        </div>
        <div class="slider-dots" id="certSliderDots"></div>
    </section>

    <section class="board-toolbar">
        <div class="toolbar-top">
            <h1>스터디 모집 게시판</h1>
            <p>원하는 스터디를 검색하거나 필터를 적용해보세요.</p>
        </div>

        <!-- 검색박스 + 자동완성 -->
        <div class="toolbar-main">
            <div class="search-box-wrapper">
                <div class="search-box">
                    <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input id="searchInput" type="text" placeholder="어떤 스터디를 찾고 계신가요? 예: React, 토익, 데이터 분석..." />
                    <button id="searchBtn" class="search-btn">
                        <span>검색</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </button>
                </div>
                <!-- 자동완성 -->
                <div id="searchSuggest" class="search-suggest hidden"></div>
            </div>

            <!-- 카테고리 필터 -->
            <div class="category-section">
                <div class="category-label">카테고리</div>
                <div class="category-grid">
                    <button class="category-chip" data-category="" th:classappend="${category == null or category == ''} ? 'active' : ''">
                        <span>전체</span>
                    </button>
                    <button class="category-chip" data-category="개발" th:classappend="${category == '개발'} ? 'active' : ''">
                        <span>개발</span>
                    </button>
                    <button class="category-chip" data-category="취업" th:classappend="${category == '취업'} ? 'active' : ''">
                        <span>취업</span>
                    </button>
                    <button class="category-chip" data-category="자격증" th:classappend="${category == '자격증'} ? 'active' : ''">
                        <span>자격증</span>
                    </button>
                    <button class="category-chip" data-category="영어" th:classappend="${category == '영어'} ? 'active' : ''">
                        <span>영어</span>
                    </button>
                    <button class="category-chip" data-category="독서" th:classappend="${category == '독서'} ? 'active' : ''">
                        <span>독서</span>
                    </button>
                    <button class="category-chip" data-category="디자인" th:classappend="${category == '디자인'} ? 'active' : ''">
                        <span>디자인</span>
                    </button>
                    <button class="category-chip" data-category="마케팅" th:classappend="${category == '마케팅'} ? 'active' : ''">
                        <span>마케팅</span>
                    </button>
                    <button class="category-chip" data-category="데이터" th:classappend="${category == '데이터'} ? 'active' : ''">
                        <span>데이터 분석</span>
                    </button>
                    <button class="category-chip" data-category="창업" th:classappend="${category == '창업'} ? 'active' : ''">
                        <span>창업</span>
                    </button>
                    <button class="category-chip" data-category="투자" th:classappend="${category == '투자'} ? 'active' : ''">
                        <span>투자/재테크</span>
                    </button>
                    <button class="category-chip" data-category="운동" th:classappend="${category == '운동'} ? 'active' : ''">
                        <span>운동/건강</span>
                    </button>
                    <button class="category-chip" data-category="취미" th:classappend="${category == '취미'} ? 'active' : ''">
                        <span>취미/여가</span>
                    </button>
                </div>
            </div>

            <!-- 정렬 필터 -->
            <div class="sort-section">
                <select id="sortFilter" class="sort-select">
                    <option value="latest" th:selected="${sort == 'latest' or sort == null}">최신순</option>
                    <option value="popular" th:selected="${sort == 'popular'}">인기순</option>
                </select>
            </div>

            <!-- 태그 필터 -->
            <div id="tagFilterRow" class="tag-filter-row"></div>
        </div>
    </section>

    <!-- 게시글 목록 -->
    <section class="board-grid" id="boardList">
        <!-- Thymeleaf로 서버 사이드 렌더링 (초기 로드) -->
        <div th:if="${posts != null and posts.content != null}" th:each="post : ${posts.content}" class="card" th:onclick="'location.href=\'/posts/' + ${post.id} + '\''">
            <div class="card-thumb" 
                 th:style="'background-image:url(https://picsum.photos/seed/' + ${post.id} + '/400/300)'"></div>
            <div class="card-body">
                <div class="card-category-badge" th:text="${post.category ?: '기타'}">카테고리</div>
                <div class="card-title" th:text="${post.title}">게시글 제목</div>
                <div class="card-meta">
                    <div class="card-stat">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        <span th:text="${post.viewCount}">0</span>
                    </div>
                    <div class="card-stat">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                        </svg>
                        <span th:text="${post.likeCount}">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div th:if="${posts == null or posts.empty}" style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #9ca3af;">
            <p>조건에 맞는 게시글이 없습니다.</p>
        </div>
    </section>

    <!-- 페이지네이션 -->
    <div class="pagination">
        <button id="prevPage" class="page-btn">이전</button>
        <span id="pageInfo" th:text="${posts != null ? ((currentPage + 1) + ' / ' + posts.totalPages) : '1 / 1'}">1 / 1</span>
        <button id="nextPage" class="page-btn">다음</button>
    </div>

</main>

<!-- AI 챗봇 -->
<button id="chatbotToggle" class="chatbot-toggle" title="AI 챗봇">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
</button>

<div id="chatbotWindow" class="chatbot-window">
    <div class="chatbot-header">
        <div class="chatbot-header-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <h3>AI 어시스턴트</h3>
        </div>
        <button id="chatbotCloseBtn" class="chatbot-close-btn" title="닫기">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div id="chatbotMessages" class="chatbot-messages">
        <div class="chatbot-message assistant">
            <div class="chatbot-message-avatar">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
            </div>
            <div class="chatbot-message-content">
                안녕하세요! Study With Me AI 어시스턴트입니다. 무엇을 도와드릴까요?<br><br>
                <strong>예시:</strong><br>
                • "마이페이지 보여줘"<br>
                • "프로그래밍 스터디 찾아줘"<br>
                • "북마크 보여줘"<br>
                • "게시글 작성하는 방법 알려줘"
            </div>
        </div>
    </div>
    <div class="chatbot-input-area">
        <input 
            id="chatbotInput" 
            class="chatbot-input" 
            type="text" 
            placeholder="메시지를 입력하세요..."
            autocomplete="off"
        />
        <button id="chatbotSendBtn" class="chatbot-send-btn" title="전송">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        </button>
    </div>
</div>

<script src="/js/board.js"></script>
<script src="/js/chatbot.js"></script>
</body>
</html>
