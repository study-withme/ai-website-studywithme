<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>마이페이지 | Study With Me</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/css/index.css" />
    <style>
        .mypage-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        .profile-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 32px;
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .profile-info h2 {
            font-size: 28px;
            margin-bottom: 8px;
            color: #1f2937;
            font-weight: 700;
        }
        .profile-info p {
            color: #6b7280;
            font-size: 15px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 24px;
            margin-top: 32px;
            padding-top: 32px;
            border-top: 1px solid #e5e7eb;
        }
        .stat-item {
            text-align: center;
            padding: 16px;
            background: #f9fafb;
            border-radius: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .stat-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 12px;
            color: #2563eb;
        }
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 4px;
        }
        .stat-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }
        .quick-links {
            margin-top: 32px;
            padding-top: 32px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .quick-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            text-decoration: none;
            color: #374151;
            font-weight: 500;
            transition: all 0.2s;
        }
        .quick-link:hover {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        .quick-link svg {
            width: 18px;
            height: 18px;
        }
        .posts-section {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .posts-section h2 {
            font-size: 24px;
            margin-bottom: 24px;
            color: #1f2937;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .posts-section h2 svg {
            width: 24px;
            height: 24px;
            color: #2563eb;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        .empty-state svg {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            color: #d1d5db;
        }
    </style>
</head>
<body>
<header>
    <div class="nav-inner">
        <div class="logo"><a href="/">Study With Me</a></div>
        <nav class="nav-links">
            <a href="/">홈</a>
            <a href="/posts/write">글쓰기</a>
        </nav>
        <div class="nav-actions">
            <a href="/logout" class="btn btn-outline">로그아웃</a>
        </div>
    </div>
</header>

<main>
    <div class="mypage-container">
        <div class="profile-section">
            <div class="profile-header">
                <div>
                    <img class="profile-avatar"
                         th:src="${profile != null && profile.profileImage != null} ? ${profile.profileImage} : 'https://i.pravatar.cc/80?img=' + ${loginUser.id}"
                         alt="프로필">
                </div>
                <div class="profile-info">
                    <h2 th:text="${loginUser.realName}">사용자 이름</h2>
                    <p th:text="${loginUser.email}">user@example.com</p>
                </div>
            </div>
            <form method="post" action="/mypage/profile-image" style="margin-top: 8px; display:flex; gap:8px; align-items:center;">
                <input name="imageUrl" placeholder="프로필 이미지 URL을 입력하세요 (비우면 기본 이미지)"
                       style="flex:1; padding:8px 10px; border-radius:8px; border:1px solid #e5e7eb;"
                       th:value="${profile != null ? profile.profileImage : ''}" />
                <button type="submit" class="btn btn-outline">저장</button>
            </form>
            <div class="stats">
                <div class="stat-item">
                    <svg class="stat-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                    </svg>
                    <div class="stat-value" th:text="${stats.level}">1</div>
                    <div class="stat-label">레벨</div>
                </div>
                <div class="stat-item">
                    <svg class="stat-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    <div class="stat-value" th:text="${stats.expPercent + '%'}">0%</div>
                    <div class="stat-label">경험치</div>
                </div>
                <div class="stat-item">
                    <svg class="stat-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <div class="stat-value" th:text="${stats.postCount}">0</div>
                    <div class="stat-label">작성한 게시글</div>
                </div>
                <div class="stat-item">
                    <svg class="stat-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    <div class="stat-value" th:text="${stats.likesReceived}">0</div>
                    <div class="stat-label">받은 좋아요</div>
                </div>
                <div class="stat-item">
                    <svg class="stat-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <div class="stat-value" th:text="${stats.applications}">0</div>
                    <div class="stat-label">지원한 스터디</div>
                </div>
            </div>
            
            <!-- 빠른 링크 -->
            <div class="quick-links">
                <a href="/my-applications" class="quick-link">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    내 지원현황
                </a>
                <a href="/study-groups" class="quick-link">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    진행중인 스터디
                </a>
            </div>
        </div>

        <div class="posts-section">
            <h2>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                내가 작성한 게시글
            </h2>
            
            <section class="card-grid" th:if="${posts.totalElements > 0}">
                <article class="card" th:each="post : ${posts.content}">
                    <div class="card-body">
                        <div class="card-category" th:if="${post.category != null}" th:text="${post.category}">카테고리</div>
                        <a th:href="@{/posts/{id}(id=${post.id})}" class="card-title" th:text="${post.title}">게시글 제목</a>
                        <p style="color: #6b7280; font-size: 14px; margin: 8px 0; line-height: 1.5;" th:text="${#strings.abbreviate(post.content, 100)}">게시글 내용 미리보기...</p>
                        <div class="card-meta">
                            <span>조회수 <strong th:text="${post.viewCount}">0</strong></span>
                            <span>좋아요 <strong th:text="${post.likeCount}">0</strong></span>
                            <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-11</span>
                        </div>
                        <div style="margin-top: 12px;">
                            <a th:href="@{/posts/{id}/edit(id=${post.id})}" class="btn btn-outline" style="font-size: 12px; padding: 4px 12px;">수정</a>
                        </div>
                    </div>
                </article>
            </section>

            <div class="empty-state" th:if="${posts.totalElements == 0}">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <p>아직 작성한 게시글이 없습니다.</p>
                <a href="/posts/write" class="btn btn-primary" style="margin-top: 16px;">첫 게시글 작성하기</a>
            </div>

            <!-- 페이지네이션 -->
            <div th:if="${posts.totalPages > 1}" style="display: flex; justify-content: center; gap: 8px; margin-top: 32px; padding: 20px;">
                <a th:if="${currentPage > 0}" 
                   th:href="@{/mypage(page=${currentPage - 1})}"
                   class="btn btn-outline">이전</a>
                <span style="display: flex; align-items: center; padding: 0 16px;">
                    <span th:text="${currentPage + 1}">1</span> / <span th:text="${posts.totalPages}">1</span>
                </span>
                <a th:if="${currentPage < posts.totalPages - 1}"
                   th:href="@{/mypage(page=${currentPage + 1})}"
                   class="btn btn-outline">다음</a>
            </div>
        </div>
    </div>
</main>

<footer>
    © 2025 Study With Me — 함께 성장하는 공부 플랫폼.
</footer>
</body>
</html>

